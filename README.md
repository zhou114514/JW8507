# JW8507 程控衰减器控制软件

一款基于 Python + PyQt5 开发的 JW8507 多通道程控衰减器控制软件，提供直观的图形界面用于控制和监测光衰减器设备。

![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)
![PyQt5](https://img.shields.io/badge/PyQt5-5.15+-green.svg)
![License](https://img.shields.io/badge/License-MPL%202.0-brightgreen.svg)

## 功能特性

- 🔌 **串口连接**：自动检测可用串口，支持多种波特率
- 📡 **多通道控制**：支持 1-8 通道同时控制
- 🌊 **波长设置**：支持多种波长选择（1310nm、1490nm、1540nm、1550nm、1563nm、1625nm 等）
- 📉 **衰减控制**：精确设置衰减值（0-99.99 dB）
- 🔴 **关断/重置**：快速关断或重置单个通道
- 📊 **实时显示**：LCD 数码管显示当前衰减值
- 📝 **日志记录**：自动记录操作日志，按日期分割保存
- ⚙️ **灵活配置**：通过配置文件自定义通道数量、波特率等参数

## 界面预览

软件采用现代化的工程软件风格设计：
- 左侧：串口设置、设备信息、日志输出
- 右侧：多通道控制面板，每个通道独立控制

## 系统要求

- Windows 7/10/11
- Python 3.8+
- USB 转串口驱动（根据实际硬件）

## 安装

### 1. 克隆项目

```bash
git clone <repository-url>
cd 程控衰减器控制
```

### 2. 安装依赖

```bash
pip install -r requirements.txt
```

或手动安装：

```bash
pip install PyQt5 pyserial
```

## 使用方法

### 启动软件

```bash
python main.py
```

### 操作步骤

1. **连接设备**
   - 将 JW8507 衰减器通过串口连接到电脑
   - 在软件中选择对应的串口和波特率
   - 点击「连接」按钮

2. **设置波长**
   - 在对应通道选择目标波长
   - 点击「设置」按钮应用

3. **设置衰减值**
   - 在衰减输入框输入目标值（0-99.99 dB）
   - 点击「设置」或按回车键应用

4. **通道控制**
   - 「关断」：将通道设为最大衰减状态
   - 「重置」：将通道衰减值清零

## 配置文件

软件配置保存在 `config.json` 文件中：

```json
{
    "channel_count": 2,
    "default_baudrate": 115200,
    "serial_timeout": 0.1
}
```

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `channel_count` | 通道数量（1-8） | 2 |
| `default_baudrate` | 默认波特率 | 115200 |
| `serial_timeout` | 串口超时时间（秒） | 0.1 |

## 项目结构

```
程控衰减器控制/
├── main.py              # 主程序入口
├── JW8507.py            # JW8507 设备通信协议
├── ChannelWidget.py     # 单通道控制组件
├── config.json          # 配置文件
├── logs/                # 日志目录
│   └── JW8507.log       # 运行日志
├── requirements.txt     # 依赖列表
└── README.md            # 说明文档
```

## 通信协议

JW8507 采用自定义串口通信协议：

- **帧格式**：帧头(1) + 地址(1) + 长度(1) + 命令(2) + 数据(0~200) + 校验(1) + 帧尾(1)
- **帧头**：0x7B (`{`)
- **帧尾**：0x7D (`}`)
- **校验算法**：`CHECK = (~(帧头+地址+长度+命令+数据)) + 1`，取低字节

### 主要命令

| 命令码 | 功能 |
|--------|------|
| 0x0003 | 读取版本信息 |
| 0x0005 | 默认显示 |
| 0x072E | 读取波长信息 |
| 0x1434 | 关断/清零 |
| 0x1436 | 读取实时信息 |
| 0x1438 | 设置输出模式 |
| 0x143A | 设置波长 |
| 0x143C | 设置衰减 |
| 0x143E | 设置锁定输出功率 |

## 日志

软件会自动将操作日志保存到 `logs/` 目录下：
- 日志按日期自动分割
- 保留最近 30 天的日志
- 格式：`[YYYY-MM-DD HH:MM:SS] 日志内容`

## 更新日志

### v1.0.0
- 正式版发布
- 支持自定义通道数量
- 各通道独立设置

## 许可证

本项目采用 Mozilla 许可证。

## 相关文档

- [JW8507A 8通道衰减器通信协议 V22.10.28.pdf](./JW8507A%208通道衰减器%20通信协议%20V22.10.28.pdf)

